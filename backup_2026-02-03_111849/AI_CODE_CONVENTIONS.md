# AI Code Conventions - OmniStock Development Standards

**Document Purpose:** Coding standards and best practices for AI assistants  
**Last Updated:** January 22, 2026  
**Version:** 1.0

---

## ğŸ¯ Overview

This document defines the coding standards, patterns, and best practices for the OmniStock platform. All code contributions must follow these conventions.

---

## ğŸ“‹ General Principles

1. **Readability First:** Code is read more often than written
2. **Consistency:** Follow existing patterns in the codebase
3. **Type Safety:** Use type declarations and strict typing
4. **Documentation:** Document complex logic and public APIs
5. **Testing:** Write tests for new features and bug fixes
6. **Security:** Never trust user input, always validate and sanitize

---

## ğŸ˜ PHP / Laravel Conventions

### **PSR-12 Compliance**
All PHP code must follow [PSR-12](https://www.php-fig.org/psr/psr-12/) coding standard.

**Formatting Tool:** Laravel Pint
```bash
./vendor/bin/pint
```

### **Type Declarations**
Always use type declarations for parameters and return types.

**âœ… Good:**
```php
public function createProduct(string $sku, float $price): Product
{
    return Product::create([
        'sku' => $sku,
        'price' => $price,
    ]);
}
```

**âŒ Bad:**
```php
public function createProduct($sku, $price)
{
    return Product::create([
        'sku' => $sku,
        'price' => $price,
    ]);
}
```

### **Strict Types**
Declare strict types at the top of every PHP file.

```php
<?php

declare(strict_types=1);

namespace App\Models;
```

### **DocBlocks**
Use DocBlocks for classes, methods, and complex logic.

```php
/**
 * Create a new product with inventory.
 *
 * @param  array<string, mixed>  $data
 * @return Product
 * @throws \Illuminate\Validation\ValidationException
 */
public function createProduct(array $data): Product
{
    // Implementation
}
```

---

## ğŸ—ï¸ Laravel Naming Conventions

### **Models**
- **Singular, PascalCase:** `Product`, `Category`, `OrderItem`
- **Table name:** Plural, snake_case (auto-detected)
- **Relationships:** Use descriptive names

```php
class Product extends Model
{
    // One-to-one
    public function inventory(): HasOne
    {
        return $this->hasOne(Inventory::class);
    }

    // One-to-many
    public function adjustments(): HasMany
    {
        return $this->hasMany(InventoryAdjustment::class);
    }

    // Many-to-many
    public function categories(): BelongsToMany
    {
        return $this->belongsToMany(Category::class);
    }
}
```

### **Controllers**
- **Singular resource name + Controller:** `ProductController`, `OrderController`
- **RESTful methods:** `index`, `create`, `store`, `show`, `edit`, `update`, `destroy`

```php
class ProductController extends Controller
{
    public function index(): View
    {
        $products = Product::with('categories')->paginate(15);
        return view('products.index', compact('products'));
    }

    public function store(StoreProductRequest $request): RedirectResponse
    {
        $product = Product::create($request->validated());
        return redirect()->route('products.show', $product);
    }
}
```

### **Requests (Form Requests)**
- **Action + Resource + Request:** `StoreProductRequest`, `UpdateCategoryRequest`

```php
class StoreProductRequest extends FormRequest
{
    public function rules(): array
    {
        return [
            'sku' => ['required', 'string', 'max:100', 'unique:products,sku'],
            'name' => ['required', 'string', 'max:255'],
            'price' => ['required', 'numeric', 'min:0'],
        ];
    }
}
```

### **Services**
- **Resource + Service:** `ProductService`, `InventoryService`
- **Purpose:** Business logic that doesn't belong in models or controllers

```php
class InventoryService
{
    public function adjustInventory(Product $product, int $delta, string $reason, ?string $note = null): InventoryAdjustment
    {
        $inventory = $product->inventory;
        $onHandBefore = $inventory->on_hand;
        $onHandAfter = $onHandBefore + $delta;

        $inventory->update(['on_hand' => $onHandAfter]);

        return InventoryAdjustment::create([
            'product_id' => $product->id,
            'admin_id' => auth('admin')->id(),
            'delta' => $delta,
            'on_hand_before' => $onHandBefore,
            'on_hand_after' => $onHandAfter,
            'reason' => $reason,
            'note' => $note,
        ]);
    }
}
```

### **Migrations**
- **Descriptive action:** `create_products_table`, `add_status_to_products_table`
- **Timestamp prefix:** Auto-generated by Laravel

```php
public function up(): void
{
    Schema::create('products', function (Blueprint $table) {
        $table->id();
        $table->string('sku', 100)->unique()->comment('Master SKU identifier');
        $table->string('name')->comment('Product name');
        $table->decimal('price', 10, 2)->comment('Selling price');
        $table->string('status')->default('active')->index();
        $table->timestamps();
        $table->softDeletes();
    });
}
```

---

## ğŸ”’ Security Best Practices

### **Mass Assignment Protection**
Always define `$fillable` or `$guarded` in models.

```php
class Product extends Model
{
    protected $fillable = [
        'sku',
        'name',
        'description',
        'price',
        'cost_price',
        'status',
    ];

    // Or use $guarded to protect specific fields
    protected $guarded = ['id', 'created_at', 'updated_at'];
}
```

### **SQL Injection Prevention**
Always use Eloquent ORM or parameter binding.

**âœ… Good:**
```php
$products = Product::where('status', $status)->get();
$products = DB::table('products')->where('status', '=', $status)->get();
```

**âŒ Bad:**
```php
$products = DB::select("SELECT * FROM products WHERE status = '$status'");
```

### **XSS Prevention**
Blade templates automatically escape output. Use `{!! !!}` only for trusted HTML.

**âœ… Good:**
```blade
<h1>{{ $product->name }}</h1>
```

**âŒ Bad:**
```blade
<h1>{!! $product->name !!}</h1>
```

### **CSRF Protection**
Always include CSRF token in forms.

```blade
<form method="POST" action="{{ route('products.store') }}">
    @csrf
    <!-- Form fields -->
</form>
```

### **Authorization**
Use policies and gates for authorization checks.

```php
// In controller
$this->authorize('update', $product);

// In Blade
@can('update', $product)
    <a href="{{ route('products.edit', $product) }}">Edit</a>
@endcan
```

---

## ğŸ—„ï¸ Database Best Practices

### **Eager Loading**
Prevent N+1 queries by eager loading relationships.

**âœ… Good:**
```php
$products = Product::with(['categories', 'images', 'inventory'])->get();
```

**âŒ Bad:**
```php
$products = Product::all();
foreach ($products as $product) {
    echo $product->categories->count(); // N+1 query
}
```

### **Query Scopes**
Use query scopes for reusable query logic.

```php
class Product extends Model
{
    public function scopeActive($query)
    {
        return $query->where('status', 'active');
    }

    public function scopeInCategory($query, int $categoryId)
    {
        return $query->whereHas('categories', function ($q) use ($categoryId) {
            $q->where('categories.id', $categoryId);
        });
    }
}

// Usage
$products = Product::active()->inCategory(5)->get();
```

### **Chunking Large Datasets**
Use `chunk()` for processing large datasets to avoid memory issues.

```php
Product::chunk(100, function ($products) {
    foreach ($products as $product) {
        // Process product
    }
});
```

---

## âš›ï¸ TypeScript / Next.js Conventions

### **File Naming**
- **Components:** PascalCase - `ProductCard.tsx`, `LanguageSwitcher.tsx`
- **Utilities:** camelCase - `formatPrice.ts`, `apiClient.ts`
- **Pages:** kebab-case or lowercase - `page.tsx`, `layout.tsx`

### **Component Structure**
```typescript
'use client';

import { useState } from 'react';
import { Product } from '@/types';

interface ProductCardProps {
  product: Product;
  onAddToCart?: (productId: number) => void;
}

export default function ProductCard({ product, onAddToCart }: ProductCardProps) {
  const [quantity, setQuantity] = useState(1);

  const handleAddToCart = () => {
    onAddToCart?.(product.id);
  };

  return (
    <div className="product-card">
      <h3>{product.name}</h3>
      <p>${product.price}</p>
      <button onClick={handleAddToCart}>Add to Cart</button>
    </div>
  );
}
```

### **Type Definitions**
Create interfaces for all data structures.

```typescript
// types/index.ts
export interface Product {
  id: number;
  sku: string;
  name: string;
  description: string;
  price: string;
  status: 'active' | 'archived';
  cover_image?: {
    url: string;
    thumbnail_url: string;
  };
  categories: Category[];
  created_at: string;
}

export interface Category {
  id: number;
  name: string;
  slug: string;
}
```

### **API Client**
Centralize API calls in a client module.

```typescript
// lib/api.ts
const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000/api';

export async function getProducts(params?: {
  category?: number;
  search?: string;
  page?: number;
}): Promise<{ data: Product[]; meta: PaginationMeta }> {
  const queryString = new URLSearchParams(params as any).toString();
  const response = await fetch(`${API_BASE_URL}/products?${queryString}`);

  if (!response.ok) {
    throw new Error('Failed to fetch products');
  }

  return response.json();
}
```

### **Internationalization**
Use next-intl for translations.

```typescript
// app/[locale]/page.tsx
import { useTranslations } from 'next-intl';

export default function HomePage() {
  const t = useTranslations('HomePage');

  return (
    <div>
      <h1>{t('title')}</h1>
      <p>{t('description')}</p>
    </div>
  );
}
```

```json
// messages/en.json
{
  "HomePage": {
    "title": "Welcome to Our Store",
    "description": "Discover beautiful gemstone products"
  }
}
```

---

## ğŸ§ª Testing Conventions

### **Test File Naming**
- **Laravel:** `tests/Feature/ProductTest.php`, `tests/Unit/InventoryServiceTest.php`
- **Next.js:** `__tests__/ProductCard.test.tsx`

### **Laravel Test Structure**
```php
<?php

namespace Tests\Feature;

use App\Models\Product;
use App\Models\Admin;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;

class ProductTest extends TestCase
{
    use RefreshDatabase;

    public function test_admin_can_create_product(): void
    {
        $admin = Admin::factory()->create();
        $this->actingAs($admin, 'admin');

        $response = $this->post(route('products.store'), [
            'sku' => 'TEST-SKU-001',
            'name' => 'Test Product',
            'price' => 49.99,
        ]);

        $response->assertRedirect();
        $this->assertDatabaseHas('products', [
            'sku' => 'TEST-SKU-001',
            'name' => 'Test Product',
        ]);
    }

    public function test_product_requires_unique_sku(): void
    {
        Product::factory()->create(['sku' => 'DUPLICATE-SKU']);

        $admin = Admin::factory()->create();
        $this->actingAs($admin, 'admin');

        $response = $this->post(route('products.store'), [
            'sku' => 'DUPLICATE-SKU',
            'name' => 'Another Product',
            'price' => 29.99,
        ]);

        $response->assertSessionHasErrors('sku');
    }
}
```

### **Test Coverage Goals**
- **Feature Tests:** All API endpoints and critical user flows
- **Unit Tests:** Complex business logic in services
- **Minimum Coverage:** 70% for new code

---

## ğŸ“ Git Commit Conventions

### **Commit Message Format**
```
<type>(<scope>): <subject>

<body>

<footer>
```

### **Types**
- `feat`: New feature
- `fix`: Bug fix
- `docs`: Documentation changes
- `style`: Code style changes (formatting, no logic change)
- `refactor`: Code refactoring
- `test`: Adding or updating tests
- `chore`: Maintenance tasks (dependencies, build, etc.)

### **Examples**
```
feat(products): add multilingual support for product names

- Added product_translations table
- Created Translatable trait
- Updated ProductController to handle translations

Closes #123
```

```
fix(inventory): prevent negative available quantity

- Added validation in InventoryService
- Updated inventory calculation logic
- Added test coverage

Fixes #456
```

---

## ğŸ” Code Review Checklist

### **Before Submitting PR**
- [ ] Code follows PSR-12 (run `./vendor/bin/pint`)
- [ ] All tests pass (`composer run test`)
- [ ] Type declarations added for all methods
- [ ] DocBlocks added for public methods
- [ ] No N+1 queries (check with Laravel Debugbar)
- [ ] Security best practices followed
- [ ] Translations added for new UI text
- [ ] Database migrations are reversible
- [ ] No sensitive data in commits (.env, credentials)

### **Reviewer Checklist**
- [ ] Code is readable and maintainable
- [ ] Business logic is correct
- [ ] Edge cases are handled
- [ ] Error handling is appropriate
- [ ] Tests cover new functionality
- [ ] No security vulnerabilities
- [ ] Performance considerations addressed
- [ ] Documentation is updated

---

## ğŸ¨ UI/UX Conventions

### **Tailwind CSS Classes**
Use Tailwind utility classes consistently.

```tsx
// âœ… Good: Consistent spacing and responsive design
<div className="container mx-auto px-4 py-8">
  <h1 className="text-3xl md:text-4xl font-bold mb-6">
    {title}
  </h1>
  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {/* Content */}
  </div>
</div>

// âŒ Bad: Inconsistent spacing, no responsive design
<div className="px-3 py-7">
  <h1 className="text-4xl font-bold mb-5">
    {title}
  </h1>
  <div className="grid grid-cols-3 gap-5">
    {/* Content */}
  </div>
</div>
```

### **Design System**
- **Primary Color:** Luxury purple/gold tones
- **Font Family:** Playfair Display (headings), Montserrat (body)
- **Spacing Scale:** 4px base (use Tailwind's default scale)
- **Border Radius:** Rounded corners (rounded-lg, rounded-xl)
- **Shadows:** Subtle shadows for depth (shadow-md, shadow-lg)

---

## ğŸ“š Documentation Standards

### **Code Comments**
- **When to comment:** Complex logic, non-obvious decisions, workarounds
- **When NOT to comment:** Self-explanatory code

```php
// âœ… Good: Explains WHY
// We use a transaction here because inventory and adjustment must be atomic
DB::transaction(function () use ($product, $delta) {
    $this->updateInventory($product, $delta);
    $this->createAdjustment($product, $delta);
});

// âŒ Bad: Explains WHAT (code already shows this)
// Loop through products
foreach ($products as $product) {
    // ...
}
```

### **README Files**
- **Project root:** High-level overview, setup instructions
- **Feature modules:** Specific feature documentation
- **API:** Endpoint documentation with examples

---

## ğŸš€ Performance Best Practices

### **Laravel**
1. **Cache frequently accessed data**
   ```php
   $categories = Cache::remember('categories', 3600, function () {
       return Category::active()->get();
   });
   ```

2. **Use database indexes** for frequently queried columns

3. **Optimize images** before uploading (resize, compress)

4. **Use queue workers** for time-consuming tasks
   ```php
   SyncInventoryJob::dispatch($listing);
   ```

### **Next.js**
1. **Use next/image** for automatic image optimization
   ```tsx
   <Image
     src={product.cover_image.url}
     alt={product.name}
     width={400}
     height={400}
     className="rounded-lg"
   />
   ```

2. **Implement pagination** for large lists

3. **Use React.memo** for expensive components
   ```tsx
   export default React.memo(ProductCard);
   ```

4. **Lazy load components** not immediately visible
   ```tsx
   const Reviews = dynamic(() => import('./Reviews'), {
     loading: () => <p>Loading reviews...</p>,
   });
   ```

---

## ğŸ”§ Development Workflow

### **Branch Strategy**
- `main` - Production-ready code
- `develop` - Integration branch for features
- `feature/feature-name` - Feature branches
- `fix/bug-description` - Bug fix branches

### **Development Process**
1. Create feature branch from `develop`
2. Implement feature with tests
3. Run tests and linting
4. Create pull request to `develop`
5. Code review and approval
6. Merge to `develop`
7. Deploy to staging for testing
8. Merge to `main` for production

---

## ğŸ“‹ Project Structure

### **Laravel (omnistock/)**
```
app/
â”œâ”€â”€ Http/
â”‚   â”œâ”€â”€ Controllers/     # HTTP controllers
â”‚   â”œâ”€â”€ Requests/        # Form request validation
â”‚   â””â”€â”€ Middleware/      # Custom middleware
â”œâ”€â”€ Models/              # Eloquent models
â”œâ”€â”€ Services/            # Business logic services
â””â”€â”€ Policies/            # Authorization policies

database/
â”œâ”€â”€ migrations/          # Database migrations
â”œâ”€â”€ seeders/             # Database seeders
â””â”€â”€ factories/           # Model factories for testing

resources/
â”œâ”€â”€ views/               # Blade templates
â””â”€â”€ js/                  # Frontend assets (Vite)

routes/
â”œâ”€â”€ web.php              # Web routes (admin panel)
â”œâ”€â”€ api.php              # API routes
â””â”€â”€ admin.php            # Admin-specific routes

tests/
â”œâ”€â”€ Feature/             # Feature tests (HTTP, integration)
â””â”€â”€ Unit/                # Unit tests (isolated logic)
```

### **Next.js (omni-ecom-nextjs/)**
```
app/
â”œâ”€â”€ [locale]/            # Locale-based routing
â”‚   â”œâ”€â”€ layout.tsx       # Root layout with i18n
â”‚   â”œâ”€â”€ page.tsx         # Home page
â”‚   â””â”€â”€ shop/            # Shop pages
â”œâ”€â”€ api/                 # API routes (if needed)
â””â”€â”€ layout.tsx           # Root layout wrapper

components/              # React components
â”œâ”€â”€ ProductCard.tsx
â”œâ”€â”€ LanguageSwitcher.tsx
â””â”€â”€ ...

lib/                     # Utilities and helpers
â”œâ”€â”€ api.ts               # API client
â””â”€â”€ utils.ts             # Helper functions

messages/                # i18n translation files
â”œâ”€â”€ en.json
â””â”€â”€ fr.json

i18n/                    # i18n configuration
â”œâ”€â”€ request.ts           # Request configuration
â””â”€â”€ routing.ts           # Routing configuration

types/                   # TypeScript type definitions
â””â”€â”€ index.ts
```

---

**Document Status:** âœ… Complete and Ready for AI Consumption
```


